# Default values for container-app-operator.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

controllerManager:
  manager:
    # -- Arguments passed to the controller manager container.
    args:
      - --metrics-bind-address=:8443
      - --leader-elect

    containerSecurityContext:
      # -- Whether a process can gain more privileges than its parent process.
      allowPrivilegeEscalation: false
      # -- Linux capabilities to drop from the container for improved security.
      capabilities:
        drop:
          - ALL

    image:
      # -- Controller manager container image repository.
      repository: controller
      # -- Controller manager container image tag.
      tag: latest
      # -- Controller manager container image pull policy.
      imagePullPolicy: IfNotPresent

    resources:
      limits:
        # -- Maximum CPU limit for the controller manager container.
        cpu: 500m
        # -- Maximum memory limit for the controller manager container.
        memory: 128Mi
      requests:
        # -- Minimum CPU request for the controller manager container.
        cpu: 10m
        # -- Minimum memory request for the controller manager container.
        memory: 64Mi

  podSecurityContext:
    # -- Run controller manager pods as non-root user.
    runAsNonRoot: true

  # -- Number of replicas for the controller manager Deployment.
  replicas: 1

  serviceAccount:
    # -- Annotations to add to the service account used by the controller manager.
    annotations: {}

# -- Domain name of the Kubernetes cluster.
kubernetesClusterDomain: cluster.local

webhookService:
  # -- List of ports exposed by the webhook service.
  ports:
    - port: 443
      protocol: TCP
      targetPort: 9443
  # -- Type of Kubernetes Service to expose the webhook (ClusterIP, NodePort, LoadBalancer).
  type: ClusterIP

# -- Configuration for CappConfig CRD
config:
  # -- Enable or disable creation of the CappConfig resource by Helm.
  enabled: true

  dnsConfig:
    # -- The DNS zone for the application.
    zone: capp-zone.com.
    # -- The canonical name that CNAMEs created by the operator should point at.
    cname: ingress.capp-zone.com.
    # -- The name of the Crossplane DNS provider config.
    provider: dns-default
    # -- The name of the Certificate External Issuer name.
    issuer: cert-issuer

  autoscaleConfig:
    # -- The default Requests Per Second (RPS) threshold for autoscaling.
    rps: 200
    # -- The default CPU utilization percentage for autoscaling.
    cpu: 80
    # -- The default memory utilization percentage for autoscaling.
    memory: 70
    # -- The default concurrency limit for autoscaling.
    concurrency: 10
    # -- The default activation scale (minimum replicas before scaling starts).
    activationScale: 3

  defaultResources:
    # -- Default compute resource limits applied to all Capp workloads.
    limits:
      # -- Maximum requested CPU per Capp workload.
      cpu: 200m
      # -- Maximum allowed memory per Capp workload.
      memory: 200Mi
    requests:
      # -- Default requested CPU per Capp workload.
      cpu: 100m
      # -- Default requested memory per Capp workload.
      memory: 100Mi

  invalidHostnamePatterns:
    # -- A list of regex patterns that hostnames of Capp workloads must not match.
    # If a Capp hostname matches one of these patterns, its creation will be blocked.
    - ""